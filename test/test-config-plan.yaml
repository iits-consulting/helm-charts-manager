env:
  - STAGE: echo test
  - GIT_VERSION: git rev-parse --verify HEAD
  - GIT_LATEST_TAG: git fetch --depth 100 && git describe --abbrev=0 --tags
  - RELEASE_VERSION: echo ${GIT_LATEST_TAG}-${GIT_VERSION}

commandSpec:
  applyCommandArgs: "upgrade -f <chartName>/values.yaml --disable-openapi-validation --create-namespace --atomic --install --wait --timeout 30m <chartName> <chartName>"
  planCommandArgs: "diff -q -f <chartName>/values.yaml upgrade --allow-unreleased <chartName> <chartName>"

defaultHelmArgs:
  test-nginx:
  test-kubernetes-dashboard: --set kubernetes-dashboard.labels.override="2"

stages:
  test:
    test-nginx: -n nginx --set nginx.containerPort=8080 --no-color
    test-kubernetes-dashboard: --set kubernetes-dashboard.labels.override=\"3\" --no-color